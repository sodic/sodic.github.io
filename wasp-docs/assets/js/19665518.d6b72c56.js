"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[5283],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=u(n),c=r,h=d["".concat(l,".").concat(c)]||d[c]||m[c]||i;return n?a.createElement(h,s(s({ref:t},p),{},{components:n})):a.createElement(h,s({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[d]="string"==typeof e?e:r,s[1]=o;for(var u=2;u<i;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(67294),r=n(86010);const i={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:n,className:s}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(i.tabItem,s),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>N});var a=n(87462),r=n(67294),i=n(86010),s=n(12466),o=n(16550),l=n(91980),u=n(67392),p=n(50012);function d(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function m(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??d(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function c(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,o.k6)(),i=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(i),(0,r.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(a.location.search);t.set(i,e),a.replace({...a.location,search:t.toString()})}),[i,a])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,i=m(e),[s,o]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!c({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:i}))),[l,u]=h({queryString:n,groupId:a}),[d,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,i]=(0,p.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:a}),k=(()=>{const e=l??d;return c({value:e,tabValues:i})?e:null})();(0,r.useLayoutEffect)((()=>{k&&o(k)}),[k]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!c({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),g(e)}),[u,g,i]),tabValues:i}}var k=n(72389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:t,block:n,selectedValue:o,selectValue:l,tabValues:u}=e;const p=[],{blockElementScrollPositionUntilNextRender:d}=(0,s.o5)(),m=e=>{const t=e.currentTarget,n=p.indexOf(t),a=u[n].value;a!==o&&(d(t),l(a))},c=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:s}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>p.push(e),onKeyDown:c,onClick:m},s,{className:(0,i.Z)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":o===t})}),n??t)})))}function v(e){let{lazy:t,children:n,selectedValue:a}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},i.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function y(e){const t=g(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",f.tabList)},r.createElement(b,(0,a.Z)({},e,t)),r.createElement(v,(0,a.Z)({},e,t)))}function N(e){const t=(0,k.Z)();return r.createElement(y,(0,a.Z)({key:String(t)},e))}},57672:(e,t,n)=>{n.d(t,{$:()=>r});var a=n(67294);function r(){return a.createElement(a.Fragment,null,a.createElement("div",{className:"auth-methods-grid"},[{title:"Email",description:"Email verification, password reset, etc.",linkToDocs:"/docs/auth/email"},{title:"Username & Password",description:"The simplest way to get started",linkToDocs:"/docs/auth/username-and-pass"},{title:"Google",description:"Users sign in with their Google account",linkToDocs:"/docs/auth/social-auth/google"},{title:"Github",description:"Users sign in with their Github account",linkToDocs:"/docs/auth/social-auth/github"}].map((e=>a.createElement(i,{title:e.title,description:e.description,linkToDocs:e.linkToDocs})))),a.createElement("p",{className:"auth-methods-info"},a.createElement("small",null,"Click on each auth method for more details.")))}function i(e){let{linkToDocs:t,title:n,description:r}=e;return a.createElement("a",{href:t,className:"auth-method-box"},a.createElement("h3",null,n," \xbb"),a.createElement("p",null,r))}},46300:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294),r=n(50012);function i(e){let{path:t}=e;const[n]=(0,r.Nk)("docusaurus.tab.js-ts"),i=t.lastIndexOf("{"),s=t.slice(i+1,t.length-1),[o,l]=s.split(","),u=t.slice(0,i);return a.createElement("code",null,u+("js"===n?o:l))}},87587:(e,t,n)=>{n.d(t,{Jp:()=>i,aH:()=>s});var a=n(67294);const r=e=>{let{color:t,children:n}=e;return a.createElement("span",{style:{border:`2px solid ${t}`,display:"inline-block",padding:"0.2em 0.4em",color:t,borderRadius:"0.4em",fontSize:"0.8em",lineHeight:"1",fontWeight:"bold"}},n)};function i(){return a.createElement(r,{color:"#0b62f5"},"internal")}function s(){return a.createElement(r,{color:"#f59e0b"},"required")}},95719:(e,t,n)=>{n.d(t,{ZP:()=>o});var a=n(87462),r=(n(67294),n(3905));n(46300);const i={toc:[]},s="wrapper";function o(e){let{components:t,...n}=e;return(0,r.kt)(s,(0,a.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"You can read more about how the ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," entity is connected to the rest of the auth system in the ",(0,r.kt)("a",{parentName:"p",href:"./entities"},"Auth Entities")," section of the docs."))}o.isMDXComponent=!0},43842:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>f,frontMatter:()=>p,metadata:()=>m,toc:()=>h});var a=n(87462),r=(n(67294),n(3905)),i=(n(46300),n(85162)),s=n(74866),o=n(57672),l=n(87587),u=n(95719);const p={title:"Overview"},d=void 0,m={unversionedId:"auth/overview",id:"auth/overview",title:"Overview",description:"Auth is an essential piece of any serious application. That's why Wasp provides authentication and authorization support out of the box.",source:"@site/docs/auth/overview.md",sourceDirName:"auth",slug:"/auth/overview",permalink:"/wasp-docs/docs/auth/overview",draft:!1,editUrl:"https://github.com/wasp-lang/wasp/edit/release/web/docs/auth/overview.md",tags:[],version:"current",frontMatter:{title:"Overview"},sidebar:"docs",previous:{title:"Databases",permalink:"/wasp-docs/docs/data-model/backends"},next:{title:"Auth UI",permalink:"/wasp-docs/docs/auth/ui"}},c={},h=[{value:"Available auth methods",id:"available-auth-methods",level:2},{value:"Protecting a page with <code>authRequired</code>",id:"protecting-a-page-with-authrequired",level:2},{value:"Logout action",id:"logout-action",level:2},{value:"Accessing the logged-in user",id:"accessing-the-logged-in-user",level:2},{value:"On the client",id:"on-the-client",level:3},{value:"Using the <code>user</code> prop",id:"using-the-user-prop",level:4},{value:"Using the <code>useAuth</code> hook",id:"using-the-useauth-hook",level:4},{value:"On the server",id:"on-the-server",level:3},{value:"Using the <code>context.user</code> object",id:"using-the-contextuser-object",level:4},{value:"Sessions",id:"sessions",level:2},{value:"User Entity",id:"user-entity",level:2},{value:"Password Hashing",id:"password-hashing",level:3},{value:"Default Validations",id:"default-validations",level:3},{value:"Username &amp; Password",id:"username--password",level:4},{value:"Email",id:"email",level:4},{value:"Customizing the Signup Process",id:"customizing-the-signup-process",level:2},{value:"1. Defining Extra Fields",id:"1-defining-extra-fields",level:3},{value:"2. Customizing the Signup Component",id:"2-customizing-the-signup-component",level:3},{value:"Using a List of Extra Fields",id:"using-a-list-of-extra-fields",level:4},{value:"Using a Single Render Function",id:"using-a-single-render-function",level:4},{value:"API Reference",id:"api-reference",level:2},{value:"Auth Fields",id:"auth-fields",level:3},{value:"<code>userEntity: entity</code> <Required />",id:"userentity-entity-",level:4},{value:"<code>methods: dict</code> <Required />",id:"methods-dict-",level:4},{value:"<code>onAuthFailedRedirectTo: String</code> <Required />",id:"onauthfailedredirectto-string-",level:4},{value:"<code>onAuthSucceededRedirectTo: String</code>",id:"onauthsucceededredirectto-string",level:4},{value:"<code>signup: SignupOptions</code>",id:"signup-signupoptions",level:4},{value:"Signup Fields Customization",id:"signup-fields-customization",level:3},{value:"<code>SignupForm</code> Customization",id:"signupform-customization",level:3}],g={toc:h},k="wrapper";function f(e){let{components:t,...n}=e;return(0,r.kt)(k,(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Auth is an essential piece of any serious application. That's why Wasp provides authentication and authorization support out of the box."),(0,r.kt)("p",null,"Here's a 1-minute tour of how full-stack auth works in Wasp:"),(0,r.kt)("div",{className:"video-container"},(0,r.kt)("iframe",{src:"https://www.youtube.com/embed/Qiro77q-ulI?si=y8Rejsbjb1HJC6FA",frameborder:"1",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0})),(0,r.kt)("p",null,"Enabling auth for your app is optional and can be done by configuring the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," field of your ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," declaration:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app MyApp {\n  title: "My app",\n  //...\n  auth: {\n    userEntity: User,\n    methods: {\n      usernameAndPassword: {}, // use this or email, not both\n      email: {}, // use this or usernameAndPassword, not both\n      google: {},\n      gitHub: {},\n    },\n    onAuthFailedRedirectTo: "/someRoute"\n  }\n}\n\n//...\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app MyApp {\n  title: "My app",\n  //...\n  auth: {\n    userEntity: User,\n    methods: {\n      usernameAndPassword: {}, // use this or email, not both\n      email: {}, // use this or usernameAndPassword, not both\n      google: {},\n      gitHub: {},\n    },\n    onAuthFailedRedirectTo: "/someRoute"\n  }\n}\n\n//...\n')))),(0,r.kt)("small",null,(0,r.kt)("p",null,"Read more about the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," field options in the ",(0,r.kt)("a",{parentName:"p",href:"#api-reference"},"API Reference")," section.")),(0,r.kt)("p",null,"We will provide a quick overview of auth in Wasp and link to more detailed documentation for each auth method."),(0,r.kt)("h2",{id:"available-auth-methods"},"Available auth methods"),(0,r.kt)("p",null,"Wasp supports the following auth methods:"),(0,r.kt)(o.$,{mdxType:"AuthMethodsGrid"}),(0,r.kt)("p",null,"Let's say we enabled the ",(0,r.kt)("a",{parentName:"p",href:"../auth/username-and-pass"},"Username & password")," authentication."),(0,r.kt)("p",null,"We get an auth backend with signup and login endpoints. We also get the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object in our ",(0,r.kt)("a",{parentName:"p",href:"../data-model/operations/overview"},"Operations")," and we can decide what to do based on whether the user is logged in or not."),(0,r.kt)("p",null,"We would also get the ",(0,r.kt)("a",{parentName:"p",href:"../auth/ui"},"Auth UI")," generated for us. We can set up our login and signup pages where our users can ",(0,r.kt)("strong",{parentName:"p"},"create their account")," and ",(0,r.kt)("strong",{parentName:"p"},"login"),". We can then protect certain pages by setting ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired: true")," for them. This will make sure that only logged-in users can access them."),(0,r.kt)("p",null,"We will also have access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object in our frontend code, so we can show different UI to logged-in and logged-out users. For example, we can show the user's name in the header alongside a ",(0,r.kt)("strong",{parentName:"p"},"logout button")," or a login button if the user is not logged in."),(0,r.kt)("h2",{id:"protecting-a-page-with-authrequired"},"Protecting a page with ",(0,r.kt)("inlineCode",{parentName:"h2"},"authRequired")),(0,r.kt)("p",null,"When declaring a page, you can set the ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired")," property."),(0,r.kt)("p",null,"If you set it to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", only authenticated users can access the page. Unauthenticated users are redirected to a route defined by the ",(0,r.kt)("inlineCode",{parentName:"p"},"app.auth.onAuthFailedRedirectTo")," field."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'page MainPage {\n  component: import Main from "@client/pages/Main.jsx",\n  authRequired: true\n}\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'page MainPage {\n  component: import Main from "@client/pages/Main.tsx",\n  authRequired: true\n}\n')))),(0,r.kt)("admonition",{title:"Requires auth method",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"You can only use ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired")," if your app uses one of the ",(0,r.kt)("a",{parentName:"p",href:"#available-auth-methods"},"available auth methods"),".")),(0,r.kt)("p",null,"If ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired")," is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", the page's React component (specified by the ",(0,r.kt)("inlineCode",{parentName:"p"},"component")," property) receives the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object as a prop. Read more about the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object in the ",(0,r.kt)("a",{parentName:"p",href:"#accessing-the-logged-in-user"},"Accessing the logged-in user section"),"."),(0,r.kt)("h2",{id:"logout-action"},"Logout action"),(0,r.kt)("p",null,"We provide an action for logging out the user. Here's how you can use it:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="client/components/LogoutButton.jsx"',title:'"client/components/LogoutButton.jsx"'},"import logout from '@wasp/auth/logout'\n\nconst LogoutButton = () => {\n  return <button onClick={logout}>Logout</button>\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="client/components/LogoutButton.tsx"',title:'"client/components/LogoutButton.tsx"'},"import logout from '@wasp/auth/logout'\n\nconst LogoutButton = () => {\n  return <button onClick={logout}>Logout</button>\n}\n")))),(0,r.kt)("h2",{id:"accessing-the-logged-in-user"},"Accessing the logged-in user"),(0,r.kt)("p",null,"You can get access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object both on the server and on the client. The ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object contains the logged-in user's data."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object has all the fields that you defined in your ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," entity, plus the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," field which contains the auth identities connected to the user. For example, if the user signed up with their email, the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object might look something like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const user = {\n  id: "19c7d164-b5cb-4dde-a0cc-0daea77cf854",\n\n  // Your entity\'s fields.\n  address: "My address",\n  // ...\n\n  // Auth identities connected to the user.\n  auth: {\n    id: "26ab6f96-ed76-4ee5-9ac3-2fd0bf19711f",\n    identities: [\n      {\n        providerName: "email",\n        providerUserId: "some@email.com",\n        providerData: { ... },\n      },\n    ]\n  },\n}\n')),(0,r.kt)(u.ZP,{mdxType:"ReadMoreAboutAuthEntities"}),(0,r.kt)("h3",{id:"on-the-client"},"On the client"),(0,r.kt)("p",null,"There are two ways to access the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object on the client:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("inlineCode",{parentName:"li"},"user")," prop"),(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("inlineCode",{parentName:"li"},"useAuth")," hook")),(0,r.kt)("h4",{id:"using-the-user-prop"},"Using the ",(0,r.kt)("inlineCode",{parentName:"h4"},"user")," prop"),(0,r.kt)("p",null,"If the page's declaration sets ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", the page's React component receives the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object as a prop:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'// ...\n\npage AccountPage {\n  component: import Account from "@client/pages/Account.jsx",\n  authRequired: true\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="client/pages/Account.jsx"',title:'"client/pages/Account.jsx"'},"import Button from './Button'\nimport logout from '@wasp/auth/logout'\n\nconst AccountPage = ({ user }) => {\n  return (\n    <div>\n      <Button onClick={logout}>Logout</Button>\n      {JSON.stringify(user, null, 2)}\n    </div>\n  )\n}\n\nexport default AccountPage\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'// ...\n\npage AccountPage {\n  component: import Account from "@client/pages/Account.tsx",\n  authRequired: true\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="client/pages/Account.tsx"',title:'"client/pages/Account.tsx"'},"import { User as AuthenticatedUser } from '@wasp/auth/types'\nimport Button from './Button'\nimport logout from '@wasp/auth/logout'\n\nconst AccountPage = ({ user }: { user: AuthenticatedUser }) => {\n  return (\n    <div>\n      <Button onClick={logout}>Logout</Button>\n      {JSON.stringify(user, null, 2)}\n    </div>\n  )\n}\n\nexport default AccountPage\n")))),(0,r.kt)("h4",{id:"using-the-useauth-hook"},"Using the ",(0,r.kt)("inlineCode",{parentName:"h4"},"useAuth")," hook"),(0,r.kt)("p",null,"Wasp provides a React hook you can use in the client components - ",(0,r.kt)("inlineCode",{parentName:"p"},"useAuth"),"."),(0,r.kt)("p",null,"This hook is a thin wrapper over Wasp's ",(0,r.kt)("inlineCode",{parentName:"p"},"useQuery")," hook and returns data in the same format."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/client/pages/MainPage.jsx"',title:'"src/client/pages/MainPage.jsx"'},"import useAuth from '@wasp/auth/useAuth'\nimport { Link } from 'react-router-dom'\nimport logout from '@wasp/auth/logout'\nimport Todo from '../Todo'\n\nexport function Main() {\n  const { data: user } = useAuth()\n\n  if (!user) {\n    return (\n      <span>\n        Please <Link to=\"/login\">login</Link> or{' '}\n        <Link to=\"/signup\">sign up</Link>.\n      </span>\n    )\n  } else {\n    return (\n      <>\n        <button onClick={logout}>Logout</button>\n        <Todo />\n      </>\n    )\n  }\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/client/pages/MainPage.tsx"',title:'"src/client/pages/MainPage.tsx"'},"import useAuth from '@wasp/auth/useAuth'\nimport { Link } from 'react-router-dom'\nimport logout from '@wasp/auth/logout'\nimport Todo from '../Todo'\n\nexport function Main() {\n  const { data: user } = useAuth()\n\n  if (!user) {\n    return (\n      <span>\n        Please <Link to='/login'>login</Link> or <Link to='/signup'>sign up</Link>.\n      </span>\n    )\n  } else {\n    return (\n      <>\n        <button onClick={logout}>Logout</button>\n        <Todo />\n      < />\n    )\n  }\n}\n")))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Since the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," prop is only available in a page's React component: use the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," prop in the page's React component and the ",(0,r.kt)("inlineCode",{parentName:"p"},"useAuth")," hook in any other React component.")),(0,r.kt)("h3",{id:"on-the-server"},"On the server"),(0,r.kt)("h4",{id:"using-the-contextuser-object"},"Using the ",(0,r.kt)("inlineCode",{parentName:"h4"},"context.user")," object"),(0,r.kt)("p",null,"When authentication is enabled, all ",(0,r.kt)("a",{parentName:"p",href:"../data-model/operations/overview"},"queries and actions")," have access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object through the ",(0,r.kt)("inlineCode",{parentName:"p"},"context")," argument. ",(0,r.kt)("inlineCode",{parentName:"p"},"context.user")," contains all User entity's fields and the auth identities connected to the user. We strip out the ",(0,r.kt)("inlineCode",{parentName:"p"},"hashedPassword")," field from the identities for security reasons."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/server/actions.js"',title:'"src/server/actions.js"'},"import HttpError from '@wasp/core/HttpError.js'\n\nexport const createTask = async (task, context) => {\n  if (!context.user) {\n    throw new HttpError(403)\n  }\n\n  const Task = context.entities.Task\n  return Task.create({\n    data: {\n      description: task.description,\n      user: {\n        connect: { id: context.user.id },\n      },\n    },\n  })\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/server/actions.ts"',title:'"src/server/actions.ts"'},"import type { Task } from '@wasp/entities'\nimport type { CreateTask } from '@wasp/actions/types'\nimport HttpError from '@wasp/core/HttpError.js'\n\ntype CreateTaskPayload = Pick<Task, 'description'>\n\nexport const createTask: CreateTask<CreateTaskPayload, Task> = async (\n  args,\n  context\n) => {\n  if (!context.user) {\n    throw new HttpError(403)\n  }\n\n  const Task = context.entities.Task\n  return Task.create({\n    data: {\n      description: args.description,\n      user: {\n        connect: { id: context.user.id },\n      },\n    },\n  })\n}\n")))),(0,r.kt)("p",null,"To implement access control in your app, each operation must check ",(0,r.kt)("inlineCode",{parentName:"p"},"context.user")," and decide what to do. For example, if ",(0,r.kt)("inlineCode",{parentName:"p"},"context.user")," is ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," inside a private operation, the user's access should be denied."),(0,r.kt)("p",null,"When using WebSockets, the ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," object is also available on the ",(0,r.kt)("inlineCode",{parentName:"p"},"socket.data")," object. Read more in the ",(0,r.kt)("a",{parentName:"p",href:"../advanced/web-sockets#websocketfn-function"},"WebSockets section"),"."),(0,r.kt)("h2",{id:"sessions"},"Sessions"),(0,r.kt)("p",null,"Wasp's auth uses sessions to keep track of the logged-in user. The session is stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"localStorage")," on the client and in the database on the server. Under the hood, Wasp uses the excellent ",(0,r.kt)("a",{parentName:"p",href:"https://v3.lucia-auth.com/"},"Lucia Auth v3")," library for session management."),(0,r.kt)("p",null,"When users log in, Wasp creates a session for them and stores it in the database. The session is then sent to the client and stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"localStorage"),". When users log out, Wasp deletes the session from the database and from ",(0,r.kt)("inlineCode",{parentName:"p"},"localStorage"),"."),(0,r.kt)("h2",{id:"user-entity"},"User Entity"),(0,r.kt)("h3",{id:"password-hashing"},"Password Hashing"),(0,r.kt)("p",null,"If you are saving a user's password in the database, you should ",(0,r.kt)("strong",{parentName:"p"},"never")," save it as plain text. You can use Wasp's helper functions for serializing and deserializing provider data which will automatically hash the password for you:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'// ...\n\naction updatePassword {\n  fn: import { updatePassword } from "@server/auth.js",\n}\n')),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/server/actions.js"',title:'"src/server/actions.js"'},"import {\n    createProviderId,\n    findAuthIdentity,\n    updateAuthIdentityProviderData,\n    deserializeAndSanitizeProviderData,\n} from '@wasp/auth/utils.js';\n\nexport const updatePassword = async (args, context) => {\n  const providerId = createProviderId('email', args.email)\n  const authIdentity = await findAuthIdentity(providerId)\n  if (!authIdentity) {\n      throw new HttpError(400, \"Unknown user\")\n  }\n  \n  const providerData = deserializeAndSanitizeProviderData(authIdentity.providerData)\n\n  // Updates the password and hashes it automatically.\n  await updateAuthIdentityProviderData(providerId, providerData, {\n      hashedPassword: args.password,\n  })\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/server/actions.ts"',title:'"src/server/actions.ts"'},"import {\n    createProviderId,\n    findAuthIdentity,\n    updateAuthIdentityProviderData,\n    deserializeAndSanitizeProviderData,\n} from '@wasp/auth/utils.js';\nimport type { UpdatePassword } from '@wasp/actions/types'\n\nexport const updatePassword: UpdatePassword<\n  { email: string; password: string },\n  void,\n> = async (args, context) => {\n  const providerId = createProviderId('email', args.email)\n  const authIdentity = await findAuthIdentity(providerId)\n  if (!authIdentity) {\n      throw new HttpError(400, \"Unknown user\")\n  }\n  \n  const providerData = deserializeAndSanitizeProviderData<'email'>(authIdentity.providerData)\n\n  // Updates the password and hashes it automatically.\n  await updateAuthIdentityProviderData(providerId, providerData, {\n      hashedPassword: args.password,\n  })\n}\n")))),(0,r.kt)("h3",{id:"default-validations"},"Default Validations"),(0,r.kt)("p",null,"When you are using the default authentication flow, Wasp validates the fields with some default validations. These validations run if you use Wasp's built-in ",(0,r.kt)("a",{parentName:"p",href:"./ui"},"Auth UI")," or if you use the provided auth actions."),(0,r.kt)("p",null,"If you decide to create your ",(0,r.kt)("a",{parentName:"p",href:"./username-and-pass#2-creating-your-custom-sign-up-action"},"custom auth actions"),", you'll need to run the validations yourself."),(0,r.kt)("p",null,"Default validations depend on the auth method you use."),(0,r.kt)("h4",{id:"username--password"},"Username & Password"),(0,r.kt)("p",null,"If you use ",(0,r.kt)("a",{parentName:"p",href:"./username-and-pass"},"Username & password")," authentication, the default validations are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"username")," must not be empty"),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"password")," must not be empty, have at least 8 characters, and contain a number")),(0,r.kt)("p",null,"Note that ",(0,r.kt)("inlineCode",{parentName:"p"},"username"),"s are stored in a ",(0,r.kt)("strong",{parentName:"p"},"case-insensitive")," manner."),(0,r.kt)("h4",{id:"email"},"Email"),(0,r.kt)("p",null,"If you use ",(0,r.kt)("a",{parentName:"p",href:"./email"},"Email")," authentication, the default validations are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"email")," must not be empty and a valid email address"),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"password")," must not be empty, have at least 8 characters, and contain a number")),(0,r.kt)("p",null,"Note that ",(0,r.kt)("inlineCode",{parentName:"p"},"email"),"s are stored in a ",(0,r.kt)("strong",{parentName:"p"},"case-insensitive")," manner."),(0,r.kt)("h2",{id:"customizing-the-signup-process"},"Customizing the Signup Process"),(0,r.kt)("p",null,"Sometimes you want to include ",(0,r.kt)("strong",{parentName:"p"},"extra fields")," in your signup process, like first name and last name and save them in the ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," entity."),(0,r.kt)("p",null,"For this to happen:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"you need to define the fields that you want saved in the database,"),(0,r.kt)("li",{parentName:"ul"},"you need to customize the ",(0,r.kt)("inlineCode",{parentName:"li"},"SignupForm")," (in the case of ",(0,r.kt)("a",{parentName:"li",href:"./email"},"Email")," or ",(0,r.kt)("a",{parentName:"li",href:"./username-and-pass"},"Username & Password")," auth)")),(0,r.kt)("p",null,"Other times, you might need to just add some ",(0,r.kt)("strong",{parentName:"p"},"extra UI")," elements to the form, like a checkbox for terms of service. In this case, customizing only the UI components is enough."),(0,r.kt)("p",null,"Let's see how to do both."),(0,r.kt)("h3",{id:"1-defining-extra-fields"},"1. Defining Extra Fields"),(0,r.kt)("p",null,"If we want to ",(0,r.kt)("strong",{parentName:"p"},"save")," some extra fields in our signup process, we need to tell our app they exist."),(0,r.kt)("p",null,"We do that by defining an object where the keys represent the field name, and the values are functions that receive the data sent from the client","*"," and return the value of the field."),(0,r.kt)("small",null,(0,r.kt)("p",null,"*"," We exclude the ",(0,r.kt)("inlineCode",{parentName:"p"},"password")," field from this object to prevent it from being saved as plain-text in the database. The ",(0,r.kt)("inlineCode",{parentName:"p"},"password")," field is handled by Wasp's auth backend.")),(0,r.kt)("p",null,"First, we add the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth.methods.{authMethod}.userSignupFields")," field in our ",(0,r.kt)("inlineCode",{parentName:"p"},"main.wasp")," file. The ",(0,r.kt)("inlineCode",{parentName:"p"},"{authMethod}")," depends on the auth method you are using."),(0,r.kt)("p",null,"For example, if you are using ",(0,r.kt)("a",{parentName:"p",href:"./username-and-pass"},"Username & Password"),", you would add the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth.methods.usernameAndPassword.userSignupFields")," field:"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app crudTesting {\n  // ...\n  auth: {\n    userEntity: User,\n    methods: {\n      usernameAndPassword: {\n        userSignupFields: import { userSignupFields } from "@server/auth/signup.js",\n      },\n    },\n    onAuthFailedRedirectTo: "/login",\n  },\n}\n\nentity User {=psl\n  id Int @id @default(autoincrement())\n  address String?\npsl=}\n')),(0,r.kt)("p",null,"Then we'll define the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSignupFields")," object in the ",(0,r.kt)("inlineCode",{parentName:"p"},"server/auth/signup.js")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server/auth/signup.js"',title:'"server/auth/signup.js"'},"import { defineUserSignupFields } from '@wasp/auth/index.js'\n\nexport const userSignupFields = defineUserSignupFields({\n  address: async (data) => {\n    const address = data.address\n    if (typeof address !== 'string') {\n      throw new Error('Address is required')\n    }\n    if (address.length < 5) {\n      throw new Error('Address must be at least 5 characters long')\n    }\n    return address\n  },\n})\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app crudTesting {\n  // ...\n  auth: {\n    userEntity: User,\n    methods: {\n      usernameAndPassword: {\n        userSignupFields: import { userSignupFields } from "@server/auth/signup.js",\n      },\n    },\n    onAuthFailedRedirectTo: "/login",\n  },\n}\n\nentity User {=psl\n  id Int @id @default(autoincrement())\n  address String?\npsl=}\n')),(0,r.kt)("p",null,"Then we'll define the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSignupFields")," object in the ",(0,r.kt)("inlineCode",{parentName:"p"},"server/auth/signup.js")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server/auth/signup.ts"',title:'"server/auth/signup.ts"'},"import { defineUserSignupFields } from '@wasp/auth/index.js'\n\nexport const userSignupFields = defineUserSignupFields({\n  address: async (data) => {\n    const address = data.address\n    if (typeof address !== 'string') {\n      throw new Error('Address is required')\n    }\n    if (address.length < 5) {\n      throw new Error('Address must be at least 5 characters long')\n    }\n    return address\n  },\n})\n")))),(0,r.kt)("small",null,(0,r.kt)("p",null,"Read more about the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSignupFields")," object in the ",(0,r.kt)("a",{parentName:"p",href:"#signup-fields-customization"},"API Reference"),".")),(0,r.kt)("p",null,"Keep in mind, that these field names need to exist on the ",(0,r.kt)("inlineCode",{parentName:"p"},"userEntity")," you defined in your ",(0,r.kt)("inlineCode",{parentName:"p"},"main.wasp")," file e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"address")," needs to be a field on the ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," entity."),(0,r.kt)("p",null,"The field function will receive the data sent from the client and it needs to return the value that will be saved into the database. If the field is invalid, the function should throw an error."),(0,r.kt)("admonition",{title:"Using Validation Libraries",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You can use any validation library you want to validate the fields. For example, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"zod")," like this:"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Click to see the code"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="server/auth/signup.js"',title:'"server/auth/signup.js"'},"import { defineUserSignupFields } from '@wasp/auth/index.js'\nimport * as z from 'zod'\n\nexport const userSignupFields = defineUserSignupFields({\n  address: (data) => {\n    const AddressSchema = z\n      .string({\n        required_error: 'Address is required',\n        invalid_type_error: 'Address must be a string',\n      })\n      .min(10, 'Address must be at least 10 characters long')\n    const result = AddressSchema.safeParse(data.address)\n    if (result.success === false) {\n      throw new Error(result.error.issues[0].message)\n    }\n    return result.data\n  },\n})\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server/auth/signup.ts"',title:'"server/auth/signup.ts"'},"import { defineUserSignupFields } from '@wasp/auth/index.js'\nimport * as z from 'zod'\n\nexport const userSignupFields = defineUserSignupFields({\n  address: (data) => {\n    const AddressSchema = z\n      .string({\n        required_error: 'Address is required',\n        invalid_type_error: 'Address must be a string',\n      })\n      .min(10, 'Address must be at least 10 characters long')\n    const result = AddressSchema.safeParse(data.address)\n    if (result.success === false) {\n      throw new Error(result.error.issues[0].message)\n    }\n    return result.data\n  },\n})\n")))))),(0,r.kt)("p",null,"Now that we defined the fields, Wasp knows how to:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Validate the data sent from the client"),(0,r.kt)("li",{parentName:"ol"},"Save the data to the database")),(0,r.kt)("p",null,"Next, let's see how to customize ",(0,r.kt)("a",{parentName:"p",href:"../auth/ui"},"Auth UI")," to include those fields."),(0,r.kt)("h3",{id:"2-customizing-the-signup-component"},"2. Customizing the Signup Component"),(0,r.kt)("admonition",{title:"Using Custom Signup Component",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you are not using Wasp's Auth UI, you can skip this section. Just make sure to include the extra fields in your custom signup form."),(0,r.kt)("p",{parentName:"admonition"},"Read more about using the signup actions for:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"email auth ",(0,r.kt)("a",{parentName:"li",href:"../auth/email#fields-in-the-email-dict"},"here")," "),(0,r.kt)("li",{parentName:"ul"},"username & password auth ",(0,r.kt)("a",{parentName:"li",href:"../auth/username-and-pass#customizing-the-auth-flow"},"here")))),(0,r.kt)("p",null,"If you are using Wasp's Auth UI, you can customize the ",(0,r.kt)("inlineCode",{parentName:"p"},"SignupForm")," component by passing the ",(0,r.kt)("inlineCode",{parentName:"p"},"additionalFields")," prop to it. It can be either a list of extra fields or a render function."),(0,r.kt)("h4",{id:"using-a-list-of-extra-fields"},"Using a List of Extra Fields"),(0,r.kt)("p",null,"When you pass in a list of extra fields to the ",(0,r.kt)("inlineCode",{parentName:"p"},"SignupForm"),", they are added to the form one by one, in the order you pass them in."),(0,r.kt)("p",null,"Inside the list, there can be either ",(0,r.kt)("strong",{parentName:"p"},"objects")," or ",(0,r.kt)("strong",{parentName:"p"},"render functions")," (you can combine them):"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Objects are a simple way to describe new fields you need, but a bit less flexible than render functions."),(0,r.kt)("li",{parentName:"ol"},"Render functions can be used to render any UI you want, but they require a bit more code. The render functions receive the ",(0,r.kt)("inlineCode",{parentName:"li"},"react-hook-form")," object and the form state object as arguments.")),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="client/SignupPage.jsx"',title:'"client/SignupPage.jsx"'},"import { SignupForm } from '@wasp/auth/forms/Signup'\nimport {\n  FormError,\n  FormInput,\n  FormItemGroup,\n  FormLabel,\n} from '@wasp/auth/forms/internal/Form'\n\nexport const SignupPage = () => {\n  return (\n    <SignupForm\n      additionalFields={[\n        /* The address field is defined using an object */\n        {\n          name: 'address',\n          label: 'Address',\n          type: 'input',\n          validations: {\n            required: 'Address is required',\n          },\n        },\n        /* The phone number is defined using a render function */\n        (form, state) => {\n          return (\n            <FormItemGroup>\n              <FormLabel>Phone Number</FormLabel>\n              <FormInput\n                {...form.register('phoneNumber', {\n                  required: 'Phone number is required',\n                })}\n                disabled={state.isLoading}\n              />\n              {form.formState.errors.phoneNumber && (\n                <FormError>\n                  {form.formState.errors.phoneNumber.message}\n                </FormError>\n              )}\n            </FormItemGroup>\n          )\n        },\n      ]}\n    />\n  )\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="client/SignupPage.tsx"',title:'"client/SignupPage.tsx"'},"import { SignupForm } from '@wasp/auth/forms/Signup'\nimport {\n  FormError,\n  FormInput,\n  FormItemGroup,\n  FormLabel,\n} from '@wasp/auth/forms/internal/Form'\n\nexport const SignupPage = () => {\n  return (\n    <SignupForm\n      additionalFields={[\n        /* The address field is defined using an object */\n        {\n          name: 'address',\n          label: 'Address',\n          type: 'input',\n          validations: {\n            required: 'Address is required',\n          },\n        },\n        /* The phone number is defined using a render function */\n        (form, state) => {\n          return (\n            <FormItemGroup>\n              <FormLabel>Phone Number</FormLabel>\n              <FormInput\n                {...form.register('phoneNumber', {\n                  required: 'Phone number is required',\n                })}\n                disabled={state.isLoading}\n              />\n              {form.formState.errors.phoneNumber && (\n                <FormError>\n                  {form.formState.errors.phoneNumber.message}\n                </FormError>\n              )}\n            </FormItemGroup>\n          )\n        },\n      ]}\n    />\n  )\n}\n")))),(0,r.kt)("small",null,(0,r.kt)("p",null,"Read more about the extra fields in the ",(0,r.kt)("a",{parentName:"p",href:"#signupform-customization"},"API Reference"),".")),(0,r.kt)("h4",{id:"using-a-single-render-function"},"Using a Single Render Function"),(0,r.kt)("p",null,"Instead of passing in a list of extra fields, you can pass in a render function which will receive the ",(0,r.kt)("inlineCode",{parentName:"p"},"react-hook-form")," object and the form state object as arguments. What ever the render function returns, will be rendered below the default fields."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="client/SignupPage.jsx"',title:'"client/SignupPage.jsx"'},"import { SignupForm } from '@wasp/auth/forms/Signup'\nimport { FormItemGroup } from '@wasp/auth/forms/internal/Form'\n\nexport const SignupPage = () => {\n  return (\n    <SignupForm\n      additionalFields={(form, state) => {\n        const username = form.watch('username')\n        return (\n          username && (\n            <FormItemGroup>\n              Hello there <strong>{username}</strong> \ud83d\udc4b\n            </FormItemGroup>\n          )\n        )\n      }}\n    />\n  )\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="client/SignupPage.tsx"',title:'"client/SignupPage.tsx"'},"import { SignupForm } from '@wasp/auth/forms/Signup'\nimport { FormItemGroup } from '@wasp/auth/forms/internal/Form'\n\nexport const SignupPage = () => {\n  return (\n    <SignupForm\n      additionalFields={(form, state) => {\n        const username = form.watch('username')\n        return (\n          username && (\n            <FormItemGroup>\n              Hello there <strong>{username}</strong> \ud83d\udc4b\n            </FormItemGroup>\n          )\n        )\n      }}\n    />\n  )\n}\n")))),(0,r.kt)("small",null,(0,r.kt)("p",null,"Read more about the render function in the ",(0,r.kt)("a",{parentName:"p",href:"#signupform-customization"},"API Reference"),".")),(0,r.kt)("h2",{id:"api-reference"},"API Reference"),(0,r.kt)("h3",{id:"auth-fields"},"Auth Fields"),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'  title: "My app",\n  //...\n  auth: {\n    userEntity: User,\n    methods: {\n      usernameAndPassword: {}, // use this or email, not both\n      email: {}, // use this or usernameAndPassword, not both\n      google: {},\n      gitHub: {},\n    },\n    onAuthFailedRedirectTo: "/someRoute",\n    signup: { ... }\n  }\n}\n\n//...\n'))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app MyApp {\n  title: "My app",\n  //...\n  auth: {\n    userEntity: User,\n    methods: {\n      usernameAndPassword: {}, // use this or email, not both\n      email: {}, // use this or usernameAndPassword, not both\n      google: {},\n      gitHub: {},\n    },\n    onAuthFailedRedirectTo: "/someRoute",\n    signup: { ... }\n  }\n}\n\n//...\n')))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"app.auth")," is a dictionary with the following fields:"),(0,r.kt)("h4",{id:"userentity-entity-"},(0,r.kt)("inlineCode",{parentName:"h4"},"userEntity: entity")," ",(0,r.kt)(l.aH,{mdxType:"Required"})),(0,r.kt)("p",null,"The entity representing the user connected to your business logic. "),(0,r.kt)(u.ZP,{mdxType:"ReadMoreAboutAuthEntities"}),(0,r.kt)("h4",{id:"methods-dict-"},(0,r.kt)("inlineCode",{parentName:"h4"},"methods: dict")," ",(0,r.kt)(l.aH,{mdxType:"Required"})),(0,r.kt)("p",null,"A dictionary of auth methods enabled for the app."),(0,r.kt)(o.$,{mdxType:"AuthMethodsGrid"}),(0,r.kt)("h4",{id:"onauthfailedredirectto-string-"},(0,r.kt)("inlineCode",{parentName:"h4"},"onAuthFailedRedirectTo: String")," ",(0,r.kt)(l.aH,{mdxType:"Required"})),(0,r.kt)("p",null,"The route to which Wasp should redirect unauthenticated user when they try to access a private page (i.e., a page that has ",(0,r.kt)("inlineCode",{parentName:"p"},"authRequired: true"),").\nCheck out these ",(0,r.kt)("a",{parentName:"p",href:"../tutorial/auth#adding-auth-to-the-project"},"essentials docs on auth")," to see an example of usage."),(0,r.kt)("h4",{id:"onauthsucceededredirectto-string"},(0,r.kt)("inlineCode",{parentName:"h4"},"onAuthSucceededRedirectTo: String")),(0,r.kt)("p",null,"The route to which Wasp will send a successfully authenticated after a successful login/signup.\nThe default value is ",(0,r.kt)("inlineCode",{parentName:"p"},'"/"'),"."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Automatic redirect on successful login only works when using the Wasp-provided ",(0,r.kt)("a",{parentName:"p",href:"../auth/ui"},"Auth UI"),".")),(0,r.kt)("h4",{id:"signup-signupoptions"},(0,r.kt)("inlineCode",{parentName:"h4"},"signup: SignupOptions")),(0,r.kt)("p",null,"Read more about the signup process customization API in the ",(0,r.kt)("a",{parentName:"p",href:"#signup-fields-customization"},"Signup Fields Customization")," section."),(0,r.kt)("h3",{id:"signup-fields-customization"},"Signup Fields Customization"),(0,r.kt)("p",null,"If you want to add extra fields to the signup process, the server needs to know how to save them to the database. You do that by defining the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth.methods.{authMethod}.userSignupFields")," field in your ",(0,r.kt)("inlineCode",{parentName:"p"},"main.wasp")," file."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app crudTesting {\n  // ...\n  auth: {\n    userEntity: User,\n    methods: {\n      usernameAndPassword: {\n        // highlight-next-line\n        userSignupFields: import { userSignupFields } from "@server/auth/signup.js",\n      },\n    },\n    onAuthFailedRedirectTo: "/login",\n  },\n}\n')),(0,r.kt)("p",null,"Then we'll export the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSignupFields")," object from the ",(0,r.kt)("inlineCode",{parentName:"p"},"server/auth/signup.js")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server/auth/signup.js"',title:'"server/auth/signup.js"'},"import { defineUserSignupFields } from '@wasp/auth/index.js'\n\nexport const userSignupFields = defineUserSignupFields({\n  address: async (data) => {\n    const address = data.address\n    if (typeof address !== 'string') {\n      throw new Error('Address is required')\n    }\n    if (address.length < 5) {\n      throw new Error('Address must be at least 5 characters long')\n    }\n    return address\n  },\n})\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-wasp",metastring:'title="main.wasp"',title:'"main.wasp"'},'app crudTesting {\n  // ...\n  auth: {\n    userEntity: User,\n    methods: {\n      usernameAndPassword: {\n        // highlight-next-line\n        userSignupFields: import { userSignupFields } from "@server/auth/signup.js",\n      },\n    },\n    onAuthFailedRedirectTo: "/login",\n  },\n}\n')),(0,r.kt)("p",null,"Then we'll export the ",(0,r.kt)("inlineCode",{parentName:"p"},"userSignupFields")," object from the ",(0,r.kt)("inlineCode",{parentName:"p"},"server/auth/signup.ts")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="server/auth/signup.ts"',title:'"server/auth/signup.ts"'},"import { defineUserSignupFields } from '@wasp/auth/index.js'\n\nexport const userSignupFields = defineUserSignupFields({\n  address: async (data) => {\n    const address = data.address\n    if (typeof address !== 'string') {\n      throw new Error('Address is required')\n    }\n    if (address.length < 5) {\n      throw new Error('Address must be at least 5 characters long')\n    }\n    return address\n  },\n})\n")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"userSignupFields")," object is an object where the keys represent the field name, and the values are functions that receive the data sent from the client","*"," and return the value of the field."),(0,r.kt)("p",null,"If the value that the function received is invalid, the function should throw an error."),(0,r.kt)("small",null,(0,r.kt)("p",null,"*"," We exclude the ",(0,r.kt)("inlineCode",{parentName:"p"},"password")," field from this object to prevent it from being saved as plain text in the database. The ",(0,r.kt)("inlineCode",{parentName:"p"},"password")," field is handled by Wasp's auth backend.")),(0,r.kt)("h3",{id:"signupform-customization"},(0,r.kt)("inlineCode",{parentName:"h3"},"SignupForm")," Customization"),(0,r.kt)("p",null,"To customize the ",(0,r.kt)("inlineCode",{parentName:"p"},"SignupForm")," component, you need to pass in the ",(0,r.kt)("inlineCode",{parentName:"p"},"additionalFields")," prop. It can be either a list of extra fields or a render function."),(0,r.kt)(s.Z,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="client/SignupPage.jsx"',title:'"client/SignupPage.jsx"'},"import { SignupForm } from '@wasp/auth/forms/Signup'\nimport {\n  FormError,\n  FormInput,\n  FormItemGroup,\n  FormLabel,\n} from '@wasp/auth/forms/internal/Form'\n\nexport const SignupPage = () => {\n  return (\n    <SignupForm\n      additionalFields={[\n        {\n          name: 'address',\n          label: 'Address',\n          type: 'input',\n          validations: {\n            required: 'Address is required',\n          },\n        },\n        (form, state) => {\n          return (\n            <FormItemGroup>\n              <FormLabel>Phone Number</FormLabel>\n              <FormInput\n                {...form.register('phoneNumber', {\n                  required: 'Phone number is required',\n                })}\n                disabled={state.isLoading}\n              />\n              {form.formState.errors.phoneNumber && (\n                <FormError>\n                  {form.formState.errors.phoneNumber.message}\n                </FormError>\n              )}\n            </FormItemGroup>\n          )\n        },\n      ]}\n    />\n  )\n}\n"))),(0,r.kt)(i.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="client/SignupPage.tsx"',title:'"client/SignupPage.tsx"'},"import { SignupForm } from '@wasp/auth/forms/Signup'\nimport {\n  FormError,\n  FormInput,\n  FormItemGroup,\n  FormLabel,\n} from '@wasp/auth/forms/internal/Form'\n\nexport const SignupPage = () => {\n  return (\n    <SignupForm\n      additionalFields={[\n        {\n          name: 'address',\n          label: 'Address',\n          type: 'input',\n          validations: {\n            required: 'Address is required',\n          },\n        },\n        (form, state) => {\n          return (\n            <FormItemGroup>\n              <FormLabel>Phone Number</FormLabel>\n              <FormInput\n                {...form.register('phoneNumber', {\n                  required: 'Phone number is required',\n                })}\n                disabled={state.isLoading}\n              />\n              {form.formState.errors.phoneNumber && (\n                <FormError>\n                  {form.formState.errors.phoneNumber.message}\n                </FormError>\n              )}\n            </FormItemGroup>\n          )\n        },\n      ]}\n    />\n  )\n}\n")))),(0,r.kt)("p",null,"The extra fields can be either ",(0,r.kt)("strong",{parentName:"p"},"objects")," or ",(0,r.kt)("strong",{parentName:"p"},"render functions")," (you can combine them):"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Objects are a simple way to describe new fields you need, but a bit less flexible than render functions."),(0,r.kt)("p",{parentName:"li"},"The objects have the following properties:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"name")," ",(0,r.kt)(l.aH,{mdxType:"Required"})),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"the name of the field"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"label")," ",(0,r.kt)(l.aH,{mdxType:"Required"})),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"the label of the field (used in the UI)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"type")," ",(0,r.kt)(l.aH,{mdxType:"Required"})),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"the type of the field, which can be ",(0,r.kt)("inlineCode",{parentName:"li"},"input")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"textarea")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"validations")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"an object with the validation rules for the field. The keys are the validation names, and the values are the validation error messages. Read more about the available validation rules in the ",(0,r.kt)("a",{parentName:"li",href:"https://react-hook-form.com/api/useform/register#register"},"react-hook-form docs"),"."))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Render functions receive the ",(0,r.kt)("inlineCode",{parentName:"p"},"react-hook-form")," object and the form state as arguments, and they can use them to render arbitrary UI elements."),(0,r.kt)("p",{parentName:"li"},"The render function has the following signature:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-ts"},";(form: UseFormReturn, state: FormState) => React.ReactNode\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"form")," ",(0,r.kt)(l.aH,{mdxType:"Required"})),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("inlineCode",{parentName:"li"},"react-hook-form")," object, read more about it in the ",(0,r.kt)("a",{parentName:"li",href:"https://react-hook-form.com/api/useform"},"react-hook-form docs")),(0,r.kt)("li",{parentName:"ul"},"you need to use the ",(0,r.kt)("inlineCode",{parentName:"li"},"form.register")," function to register your fields"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"state")," ",(0,r.kt)(l.aH,{mdxType:"Required"})),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"the form state object which has the following properties:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"isLoading: boolean"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"whether the form is currently submitting")))))))))))}f.isMDXComponent=!0}}]);