"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[2158],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>k});var n=a(67294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,o=e.originalType,p=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),u=s(a),c=l,k=u["".concat(p,".").concat(c)]||u[c]||m[c]||o;return a?n.createElement(k,i(i({ref:t},d),{},{components:a})):n.createElement(k,i({ref:t},d))}));function k(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=a.length,i=new Array(o);i[0]=c;var r={};for(var p in t)hasOwnProperty.call(t,p)&&(r[p]=t[p]);r.originalType=e,r[u]="string"==typeof e?e:l,i[1]=r;for(var s=2;s<o;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},46300:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),l=a(50012);function o(e){let{path:t}=e;const[a]=(0,l.Nk)("docusaurus.tab.js-ts"),o=t.lastIndexOf("{"),i=t.slice(o+1,t.length-1),[r,p]=i.split(","),s=t.slice(0,o);return n.createElement("code",null,s+("js"===a?r:p))}},87587:(e,t,a)=>{a.d(t,{Jp:()=>o,aH:()=>i});var n=a(67294);const l=e=>{let{color:t,children:a}=e;return n.createElement("span",{style:{border:`2px solid ${t}`,display:"inline-block",padding:"0.2em 0.4em",color:t,borderRadius:"0.4em",fontSize:"0.8em",lineHeight:"1",fontWeight:"bold"}},a)};function o(){return n.createElement(l,{color:"#0b62f5"},"internal")}function i(){return n.createElement(l,{color:"#f59e0b"},"required")}},13977:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>h,contentTitle:()=>c,default:()=>g,frontMatter:()=>m,metadata:()=>k,toc:()=>y});var n=a(87462),l=(a(67294),a(3905));a(46300),a(44996);const o={toc:[]},i="wrapper";function r(e){let{components:t,...a}=e;return(0,l.kt)(i,(0,n.Z)({},o,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("admonition",{title:"Using an external auth method?",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"If your app is using an external authentication method(s) supported by Wasp (such as ",(0,l.kt)("a",{parentName:"p",href:"../../auth/social-auth/google#4-adding-environment-variables"},"Google")," or ",(0,l.kt)("a",{parentName:"p",href:"../../auth/social-auth/github#4-adding-environment-variables"},"GitHub"),"), make sure to additionally set the necessary environment variables specifically required by these method(s).")))}r.isMDXComponent=!0;const p={toc:[]},s="wrapper";function d(e){let{components:t,...a}=e;return(0,l.kt)(s,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"To build the web app, position yourself in ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/web-app")," directory:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"cd .wasp/build/web-app\n")),(0,l.kt)("p",null,"Run"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"npm install && REACT_APP_API_URL=<url_to_wasp_backend> npm run build\n")),(0,l.kt)("p",null,"where ",(0,l.kt)("inlineCode",{parentName:"p"},"<url_to_wasp_backend>")," is the URL of the Wasp server that you previously deployed."))}d.isMDXComponent=!0;var u=a(87587);const m={title:"Deploying Manually"},c=void 0,k={unversionedId:"advanced/deployment/manually",id:"advanced/deployment/manually",title:"Deploying Manually",description:"We'll cover how to deploy your Wasp app manually to a variety of providers:",source:"@site/docs/advanced/deployment/manually.md",sourceDirName:"advanced/deployment",slug:"/advanced/deployment/manually",permalink:"/wasp-docs/docs/advanced/deployment/manually",draft:!1,editUrl:"https://github.com/wasp-lang/wasp/edit/release/web/docs/advanced/deployment/manually.md",tags:[],version:"current",frontMatter:{title:"Deploying Manually"},sidebar:"docs",previous:{title:"Deploying with the Wasp CLI",permalink:"/wasp-docs/docs/advanced/deployment/cli"},next:{title:"Sending Emails",permalink:"/wasp-docs/docs/advanced/email/"}},h={},y=[{value:"Deploying a Wasp App",id:"deploying-a-wasp-app",level:2},{value:"1. Generating Deployable Code",id:"1-generating-deployable-code",level:3},{value:"2. Deploying the API Server (backend)",id:"2-deploying-the-api-server-backend",level:3},{value:"Environment Variables",id:"environment-variables",level:4},{value:"3. Deploying the Web Client (frontend)",id:"3-deploying-the-web-client-frontend",level:3},{value:"4. Deploying the Database",id:"4-deploying-the-database",level:3},{value:"Different Providers",id:"different-providers",level:2},{value:"Fly.io (server and database)",id:"flyio-server-and-database",level:2},{value:"Set Up a Fly.io App",id:"set-up-a-flyio-app",level:3},{value:"Deploy to a Fly.io App",id:"deploy-to-a-flyio-app",level:3},{value:"Redeploying After Wasp Builds",id:"redeploying-after-wasp-builds",level:3},{value:"Netlify (client)",id:"netlify-client",level:2},{value:"Railway (server, client and database)",id:"railway-server-client-and-database",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Create New Project",id:"create-new-project",level:3},{value:"Deploy Your App to Railway",id:"deploy-your-app-to-railway",level:3},{value:"Setup Domains",id:"setup-domains",level:4},{value:"Deploying the Server",id:"deploying-the-server",level:4},{value:"Deploying the Client",id:"deploying-the-client",level:4},{value:"Conclusion",id:"conclusion",level:4},{value:"Updates &amp; Redeploying",id:"updates--redeploying",level:3},{value:"Heroku (server and database)",id:"heroku-server-and-database",level:2},{value:"Set Up a Heroku App",id:"set-up-a-heroku-app",level:3},{value:"Deploy to a Heroku App",id:"deploy-to-a-heroku-app",level:3}],N={toc:y},f="wrapper";function g(e){let{components:t,...o}=e;return(0,l.kt)(f,(0,n.Z)({},N,o,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"We'll cover how to deploy your Wasp app manually to a variety of providers:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#flyio"},"Fly.io")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#netlify"},"Netlify")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#railway"},"Railway")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#heroku"},"Heroku"))),(0,l.kt)("h2",{id:"deploying-a-wasp-app"},"Deploying a Wasp App"),(0,l.kt)("p",null,"Deploying a Wasp app comes down to the following:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Generating deployable code."),(0,l.kt)("li",{parentName:"ol"},"Deploying the API server (backend)."),(0,l.kt)("li",{parentName:"ol"},"Deploying the web client (frontend)."),(0,l.kt)("li",{parentName:"ol"},"Deploying a PostgreSQL database and keeping it running.")),(0,l.kt)("p",null,"Let's go through each of these steps."),(0,l.kt)("h3",{id:"1-generating-deployable-code"},"1. Generating Deployable Code"),(0,l.kt)("p",null,"Running the command ",(0,l.kt)("inlineCode",{parentName:"p"},"wasp build")," generates deployable code for the whole app in the ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"wasp build\n")),(0,l.kt)("admonition",{title:"PostgreSQL in production",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"You won't be able to build the app if you are using SQLite as a database (which is the default database).\nYou'll have to ",(0,l.kt)("a",{parentName:"p",href:"../../data-model/backends#migrating-from-sqlite-to-postgresql"},"switch to PostgreSQL")," before deploying to production.")),(0,l.kt)("h3",{id:"2-deploying-the-api-server-backend"},"2. Deploying the API Server (backend)"),(0,l.kt)("p",null,"There's a Dockerfile that defines an image for building the server in the ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build")," directory."),(0,l.kt)("p",null,"To run the server in production, deploy this Docker image to a hosting provider and ensure the required environment variables on the provider are correctly set up (the mechanism of setting these up is specific per provider).\nAll necessary environment variables are listed in the next section."),(0,l.kt)("h4",{id:"environment-variables"},"Environment Variables"),(0,l.kt)("p",null,"Here are the environment variables your server will be looking for:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," ",(0,l.kt)(u.aH,{mdxType:"Required"})),(0,l.kt)("p",{parentName:"li"},"The URL of the Postgres database you want your app to use (e.g., ",(0,l.kt)("inlineCode",{parentName:"p"},"postgresql://mydbuser:mypass@localhost:5432/nameofmydb"),").")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," ",(0,l.kt)(u.aH,{mdxType:"Required"})),(0,l.kt)("p",{parentName:"li"},"The URL where you plan to deploy your frontend app is running (e.g., ",(0,l.kt)("inlineCode",{parentName:"p"},"https://<app-name>.netlify.app"),").\nThe server needs to know about it to properly configure Same-Origin Policy (CORS) headers.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"JWT_SECRET")," (",(0,l.kt)(u.aH,{mdxType:"Required"})," if using Wasp Auth)"),(0,l.kt)("p",{parentName:"li"},"You only need this environment variable if you're using Wasp's ",(0,l.kt)("inlineCode",{parentName:"p"},"auth")," features.\nSet it to a random string at least 32 characters long (you can use an ",(0,l.kt)("a",{parentName:"p",href:"https://djecrety.ir/"},"online generator"),").")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"PORT")),(0,l.kt)("p",{parentName:"li"},"The server's HTTP port number. This is where the server listens for requests (default: ",(0,l.kt)("inlineCode",{parentName:"p"},"3001"),")."))),(0,l.kt)(r,{mdxType:"AddExternalAuthEnvVarsReminder"}),(0,l.kt)("p",null,"While these are the general instructions on deploying the server anywhere, we also have more detailed instructions for chosen providers below, so check that out for more guidance if you are deploying to one of those providers."),(0,l.kt)("h3",{id:"3-deploying-the-web-client-frontend"},"3. Deploying the Web Client (frontend)"),(0,l.kt)(d,{mdxType:"BuildingTheWebClient"}),(0,l.kt)("p",null,"The command above will build the web client and put it in the ",(0,l.kt)("inlineCode",{parentName:"p"},"build/")," directory in the ",(0,l.kt)("inlineCode",{parentName:"p"},"web-app")," directory."),(0,l.kt)("p",null,"Since the app's frontend is just a bunch of static files, you can deploy it to any static hosting provider."),(0,l.kt)("h3",{id:"4-deploying-the-database"},"4. Deploying the Database"),(0,l.kt)("p",null,"Any PostgreSQL database will do, as long as you provide the server with the correct ",(0,l.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," env var and ensure that the database is accessible from the server."),(0,l.kt)("h2",{id:"different-providers"},"Different Providers"),(0,l.kt)("p",null,"We'll cover a few different deployment providers below:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Fly.io (server and database)"),(0,l.kt)("li",{parentName:"ul"},"Netlify (client)"),(0,l.kt)("li",{parentName:"ul"},"Railway (server, client and database)"),(0,l.kt)("li",{parentName:"ul"},"Heroku (server and database)")),(0,l.kt)("h2",{id:"flyio-server-and-database"},"Fly.io (server and database)"),(0,l.kt)("p",null,"We will show how to deploy the server and provision a database for it on Fly.io."),(0,l.kt)("admonition",{title:"We automated this process for you",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"If you want to do all of the work below with one command, you can use the ",(0,l.kt)("a",{parentName:"p",href:"../../advanced/deployment/cli#flyio"},"Wasp CLI"),"."),(0,l.kt)("p",{parentName:"admonition"},"Wasp CLI deploys the server, deploys the client, and sets up a database.\nIt also gives you a way to redeploy (update) your app with a single command.")),(0,l.kt)("p",null,"Fly.io offers a variety of free services that are perfect for deploying your first Wasp app! You will need a Fly.io account and the ",(0,l.kt)("a",{parentName:"p",href:"https://fly.io/docs/hands-on/install-flyctl/"},(0,l.kt)("inlineCode",{parentName:"a"},"flyctl")," CLI"),"."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"Fly.io offers support for both locally built Docker containers and remotely built ones. However, for simplicity and reproducibility, we will default to the use of a remote Fly.io builder."),(0,l.kt)("p",{parentName:"admonition"},"Additionally, ",(0,l.kt)("inlineCode",{parentName:"p"},"fly")," is a symlink for ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl")," on most systems and they can be used interchangeably.")),(0,l.kt)("p",null,"Make sure you are logged in with ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl")," CLI. You can check if you are logged in with ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl auth whoami"),", and if you are not, you can log in with ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl auth login"),"."),(0,l.kt)("h3",{id:"set-up-a-flyio-app"},"Set Up a Fly.io App"),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"You need to do this only once per Wasp app.")),(0,l.kt)("p",null,"Unless you already have a Fly.io app that you want to deploy to, let's create a new Fly.io app."),(0,l.kt)("p",null,"After you have ",(0,l.kt)("a",{parentName:"p",href:"#1-generating-deployable-code"},"built the app"),", position yourself in ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd .wasp/build\n")),(0,l.kt)("p",null,"Next, run the launch command to set up a new app and create a ",(0,l.kt)("inlineCode",{parentName:"p"},"fly.toml")," file:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"flyctl launch --remote-only\n")),(0,l.kt)("p",null,"This will ask you a series of questions, such as asking you to choose a region and whether you'd like a database."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Say ",(0,l.kt)("strong",{parentName:"p"},"yes")," to ",(0,l.kt)("strong",{parentName:"p"},"Would you like to set up a Postgresql database now?")," and select ",(0,l.kt)("strong",{parentName:"p"},"Development"),". Fly.io will set a ",(0,l.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," for you.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Say ",(0,l.kt)("strong",{parentName:"p"},"no")," to ",(0,l.kt)("strong",{parentName:"p"},"Would you like to deploy now?")," (and to any additional questions)."),(0,l.kt)("p",{parentName:"li"},"We still need to set up several environment variables."))),(0,l.kt)("admonition",{title:"What if the database setup fails?",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"If your attempts to initiate a new app fail for whatever reason, then you should run ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl apps destroy <app-name>")," before trying again. Fly does not allow you to create multiple apps with the same name."),(0,l.kt)("details",null,(0,l.kt)("summary",null,"What does it look like when your DB is deployed correctly?"),(0,l.kt)("div",null,(0,l.kt)("p",null,"When your DB is deployed correctly, you'll see it in the ",(0,l.kt)("a",{href:"https://fly.io/dashboard"},"Fly.io dashboard"),":"),(0,l.kt)("img",{width:"662",alt:"image",src:"/img/deploying/fly-db.png"})))),(0,l.kt)("p",null,"Next, let's copy the ",(0,l.kt)("inlineCode",{parentName:"p"},"fly.toml")," file up to our Wasp project dir for safekeeping."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cp fly.toml ../../\n")),(0,l.kt)("p",null,"Next, let's add a few more environment variables:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"flyctl secrets set PORT=8080\nflyctl secrets set JWT_SECRET=<random_string_at_least_32_characters_long>\nflyctl secrets set WASP_WEB_CLIENT_URL=<url_of_where_frontend_will_be_deployed>\n")),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"If you do not know what your frontend URL is yet, don't worry. You can set ",(0,l.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," after you deploy your frontend.")),(0,l.kt)(r,{mdxType:"AddExternalAuthEnvVarsReminder"}),(0,l.kt)("p",null,"If you want to make sure you've added your secrets correctly, run ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl secrets list")," in the terminal. Note that you will see hashed versions of your secrets to protect your sensitive data."),(0,l.kt)("h3",{id:"deploy-to-a-flyio-app"},"Deploy to a Fly.io App"),(0,l.kt)("p",null,"While still in the ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory, run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"flyctl deploy --remote-only --config ../../fly.toml\n")),(0,l.kt)("p",null,"This will build and deploy the backend of your Wasp app on Fly.io to ",(0,l.kt)("inlineCode",{parentName:"p"},"https://<app-name>.fly.dev")," \ud83e\udd18\ud83c\udfb8"),(0,l.kt)("p",null,"Now, if you haven't, you can deploy your frontend and add the client url by running ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl secrets set WASP_WEB_CLIENT_URL=<url_of_deployed_frontend>"),". We suggest using ",(0,l.kt)("a",{parentName:"p",href:"#netlify"},"Netlify")," for your frontend, but you can use any static hosting provider."),(0,l.kt)("p",null,"Additionally, some useful ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl")," commands:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"flyctl logs\nflyctl secrets list\nflyctl ssh console\n")),(0,l.kt)("h3",{id:"redeploying-after-wasp-builds"},"Redeploying After Wasp Builds"),(0,l.kt)("p",null,"When you rebuild your Wasp app (with ",(0,l.kt)("inlineCode",{parentName:"p"},"wasp build"),"), it will remove your ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory. In there, you may have a ",(0,l.kt)("inlineCode",{parentName:"p"},"fly.toml")," from any prior Fly.io deployments."),(0,l.kt)("p",null,"While we will improve this process in the future, in the meantime, you have a few options:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Copy the ",(0,l.kt)("inlineCode",{parentName:"p"},"fly.toml")," file to a versioned directory, like your Wasp project dir."),(0,l.kt)("p",{parentName:"li"},"From there, you can reference it in ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl deploy --config <path>")," commands, like above.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Backup the ",(0,l.kt)("inlineCode",{parentName:"p"},"fly.toml")," file somewhere before running ",(0,l.kt)("inlineCode",{parentName:"p"},"wasp build"),", and copy it into .wasp/build/ after."),(0,l.kt)("p",{parentName:"li"},"When the ",(0,l.kt)("inlineCode",{parentName:"p"},"fly.toml")," file exists in .wasp/build/ dir, you do not need to specify the ",(0,l.kt)("inlineCode",{parentName:"p"},"--config <path>"),".")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"flyctl config save -a <app-name>")," to regenerate the ",(0,l.kt)("inlineCode",{parentName:"p"},"fly.toml")," file from the remote state stored in Fly.io."))),(0,l.kt)("h2",{id:"netlify-client"},"Netlify (client)"),(0,l.kt)("p",null,"We'll show how to deploy the client on Netlify."),(0,l.kt)("p",null,"Netlify is a static hosting solution that is free for many use cases. You will need a Netlify account and ",(0,l.kt)("a",{parentName:"p",href:"https://docs.netlify.com/cli/get-started/"},"Netlify CLI")," installed to follow these instructions."),(0,l.kt)("p",null,"Make sure you are logged in with Netlify CLI. You can check if you are logged in with ",(0,l.kt)("inlineCode",{parentName:"p"},"netlify status"),", and if you are not, you can log in with ",(0,l.kt)("inlineCode",{parentName:"p"},"netlify login"),"."),(0,l.kt)("p",null,"First, make sure you have ",(0,l.kt)("a",{parentName:"p",href:"#1-generating-deployable-code"},"built the Wasp app"),". We'll build the client web app next."),(0,l.kt)(d,{mdxType:"BuildingTheWebClient"}),(0,l.kt)("p",null,"We can now deploy the client with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"netlify deploy\n")),(0,l.kt)("small",null,(0,l.kt)("p",null,"Carefully follow the instructions i.e. do you want to create a new app or use an existing one, the team under which your app will reside etc.")),(0,l.kt)("p",null,"The final step is to run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"netlify deploy --prod`\n")),(0,l.kt)("p",null,"That is it! Your client should be live at ",(0,l.kt)("inlineCode",{parentName:"p"},"https://<app-name>.netlify.app")," \u2728"),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"Make sure you set this URL as the ",(0,l.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," environment variable in your server hosting environment (e.g., Fly.io or Heroku).")),(0,l.kt)("h2",{id:"railway-server-client-and-database"},"Railway (server, client and database)"),(0,l.kt)("p",null,"We will show how to deploy the client, the server, and provision a database on Railway."),(0,l.kt)("p",null,"Railway is a simple and great way to host your server and database. It's also possible to deploy your entire app: database, server, and client. You can use the platform for free for a limited time, or if you meet certain eligibility requirements. See their ",(0,l.kt)("a",{parentName:"p",href:"https://docs.railway.app/reference/plans"},"plans page")," for more info."),(0,l.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("p",null,"To get started, follow these steps:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Make sure your Wasp app is built by running ",(0,l.kt)("inlineCode",{parentName:"p"},"wasp build")," in the project dir.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Create a ",(0,l.kt)("a",{parentName:"p",href:"https://railway.app/"},"Railway")," account"),(0,l.kt)("admonition",{parentName:"li",title:"Free Tier",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"Sign up with your GitHub account to be eligible for the free tier"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Install the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.railway.app/develop/cli#installation"},"Railway CLI"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"railway login")," and a browser tab will open to authenticate you."))),(0,l.kt)("h3",{id:"create-new-project"},"Create New Project"),(0,l.kt)("p",null,"Let's create our Railway project:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Go to your ",(0,l.kt)("a",{parentName:"li",href:"https://railway.app/dashboard"},"Railway dashboard"),", click on ",(0,l.kt)("strong",{parentName:"li"},"New Project"),", and select ",(0,l.kt)("inlineCode",{parentName:"li"},"Provision PostgreSQL")," from the dropdown menu."),(0,l.kt)("li",{parentName:"ol"},"Once it initializes, right-click on the ",(0,l.kt)("strong",{parentName:"li"},"New")," button in the top right corner and select ",(0,l.kt)("strong",{parentName:"li"},"Empty Service"),"."),(0,l.kt)("li",{parentName:"ol"},"Once it initializes, click on it, go to ",(0,l.kt)("strong",{parentName:"li"},"Settings > General")," and change the name to ",(0,l.kt)("inlineCode",{parentName:"li"},"server")),(0,l.kt)("li",{parentName:"ol"},"Go ahead and create another empty service and name it ",(0,l.kt)("inlineCode",{parentName:"li"},"client"))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Changing the name",src:a(63031).Z,width:"2444",height:"1556"})),(0,l.kt)("h3",{id:"deploy-your-app-to-railway"},"Deploy Your App to Railway"),(0,l.kt)("h4",{id:"setup-domains"},"Setup Domains"),(0,l.kt)("p",null,"We'll need the domains for both the ",(0,l.kt)("inlineCode",{parentName:"p"},"server")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"client")," services:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Go to the ",(0,l.kt)("inlineCode",{parentName:"li"},"server")," instance's ",(0,l.kt)("inlineCode",{parentName:"li"},"Settings")," tab, and click ",(0,l.kt)("inlineCode",{parentName:"li"},"Generate Domain"),"."),(0,l.kt)("li",{parentName:"ol"},"Do the same under the ",(0,l.kt)("inlineCode",{parentName:"li"},"client"),"'s ",(0,l.kt)("inlineCode",{parentName:"li"},"Settings"),".")),(0,l.kt)("p",null,"Copy the domains as we will need them later."),(0,l.kt)("h4",{id:"deploying-the-server"},"Deploying the Server"),(0,l.kt)("p",null,"Let's deploy our server first:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Move into your app's ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd .wasp/build\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Link your app build to your newly created Railway project:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"railway link\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Go into the Railway dashboard and set up the required env variables:"),(0,l.kt)("p",{parentName:"li"},"Open the ",(0,l.kt)("inlineCode",{parentName:"p"},"Settings")," and go to the ",(0,l.kt)("inlineCode",{parentName:"p"},"Variables")," tab:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"click ",(0,l.kt)("strong",{parentName:"p"},"Variable reference")," and select ",(0,l.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," (it will populate it with the correct value)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"add ",(0,l.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," - enter the the ",(0,l.kt)("inlineCode",{parentName:"p"},"client")," domain (e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"https://client-production-XXXX.up.railway.app"),")")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"add ",(0,l.kt)("inlineCode",{parentName:"p"},"JWT_SECRET")," - enter a random string at least 32 characters long (use an ",(0,l.kt)("a",{parentName:"p",href:"https://djecrety.ir/"},"online generator"),")"),(0,l.kt)(r,{mdxType:"AddExternalAuthEnvVarsReminder"})))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Push and deploy the project:"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"railway up\n")),(0,l.kt)("p",null,"Select ",(0,l.kt)("inlineCode",{parentName:"p"},"server")," when prompted with ",(0,l.kt)("inlineCode",{parentName:"p"},"Select Service"),"."),(0,l.kt)("p",null,"Railway will now locate the Dockerfile and deploy your server \ud83d\udc4d"),(0,l.kt)("h4",{id:"deploying-the-client"},"Deploying the Client"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Next, change into your app's frontend build directory ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/web-app"),":"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd web-app\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Create the production build, using the ",(0,l.kt)("inlineCode",{parentName:"p"},"server")," domain as the ",(0,l.kt)("inlineCode",{parentName:"p"},"REACT_APP_API_URL"),":"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"npm install && REACT_APP_API_URL=<url_to_wasp_backend> npm run build\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Next, we want to link this specific frontend directory to our project as well:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"railway link\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"We need to configure Railway's static hosting for our client."),(0,l.kt)("admonition",{parentName:"li",title:"Setting Up Static Hosting",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"Copy the ",(0,l.kt)("inlineCode",{parentName:"p"},"build")," folder within the ",(0,l.kt)("inlineCode",{parentName:"p"},"web-app")," directory to ",(0,l.kt)("inlineCode",{parentName:"p"},"dist"),":"),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cp -r build dist\n")),(0,l.kt)("p",{parentName:"admonition"},"We'll need to create the following files:"),(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"Dockerfile")," with:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-Dockerfile",metastring:'title="Dockerfile"',title:'"Dockerfile"'},'FROM pierrezemb/gostatic\nCMD [ "-fallback", "index.html" ]\nCOPY ./dist/ /srv/http/\n'))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},".dockerignore")," with:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=".dockerignore"',title:'".dockerignore"'},"node_modules/\n")))),(0,l.kt)("p",{parentName:"admonition"},"You'll need to repeat these steps ",(0,l.kt)("strong",{parentName:"p"},"each time")," you run ",(0,l.kt)("inlineCode",{parentName:"p"},"wasp build")," as it will remove the ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/web-app")," directory."),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Here's a useful shell script to do the process"),(0,l.kt)("p",{parentName:"admonition"},"If you want to automate the process, save the following as ",(0,l.kt)("inlineCode",{parentName:"p"},"deploy_client.sh")," in the root of your project:"),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="deploy_client.sh"',title:'"deploy_client.sh"'},'#!/usr/bin/env bash\n\nif [ -z "$REACT_APP_API_URL" ]\nthen\n  echo "REACT_APP_API_URL is not set"\n  exit 1\nfi\n\nwasp build\ncd .wasp/build/web-app\n\nnpm install && REACT_APP_API_URL=$REACT_APP_API_URL npm run build\n\ncp -r build dist\n\ndockerfile_contents=$(cat <<EOF\nFROM pierrezemb/gostatic\nCMD [ "-fallback", "index.html" ]\nCOPY ./dist/ /srv/http/\nEOF\n)\n\ndockerignore_contents=$(cat <<EOF\nnode_modules/\nEOF\n)\n\necho "$dockerfile_contents" > Dockerfile\necho "$dockerignore_contents" > .dockerignore\n\nrailway up\n')),(0,l.kt)("p",{parentName:"admonition"},"Make it executable with:"),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"chmod +x deploy_client.sh\n")),(0,l.kt)("p",{parentName:"admonition"},"You can run it with:"),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"REACT_APP_API_URL=<url_to_wasp_backend> ./deploy_client.sh\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Set the ",(0,l.kt)("inlineCode",{parentName:"p"},"PORT")," environment variable to ",(0,l.kt)("inlineCode",{parentName:"p"},"8043")," under the ",(0,l.kt)("inlineCode",{parentName:"p"},"Variables")," tab.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Deploy the client and select ",(0,l.kt)("inlineCode",{parentName:"p"},"client")," when prompted with ",(0,l.kt)("inlineCode",{parentName:"p"},"Select Service"),":"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"railway up\n")),(0,l.kt)("h4",{id:"conclusion"},"Conclusion"),(0,l.kt)("p",null,"And now your Wasp should be deployed! \ud83d\udc1d \ud83d\ude82 \ud83d\ude80"),(0,l.kt)("p",null,"Back in your ",(0,l.kt)("a",{parentName:"p",href:"https://railway.app/dashboard"},"Railway dashboard"),", click on your project and you should see your newly deployed services: Postgres, Server, and Client."),(0,l.kt)("h3",{id:"updates--redeploying"},"Updates & Redeploying"),(0,l.kt)("p",null,"When you make updates and need to redeploy:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"run ",(0,l.kt)("inlineCode",{parentName:"li"},"wasp build")," to rebuild your app"),(0,l.kt)("li",{parentName:"ul"},"run ",(0,l.kt)("inlineCode",{parentName:"li"},"railway up")," in the ",(0,l.kt)("inlineCode",{parentName:"li"},".wasp/build")," directory (server)"),(0,l.kt)("li",{parentName:"ul"},"repeat all the steps in the ",(0,l.kt)("inlineCode",{parentName:"li"},".wasp/build/web-app")," directory (client)")),(0,l.kt)("h2",{id:"heroku-server-and-database"},"Heroku (server and database)"),(0,l.kt)("p",null,"We will show how to deploy the server and provision a database for it on Heroku."),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"Heroku used to offer free apps under certain limits. However, as of November 28, 2022, they ended support for their free tier. ",(0,l.kt)("a",{parentName:"p",href:"https://blog.heroku.com/next-chapter"},"https://blog.heroku.com/next-chapter")),(0,l.kt)("p",{parentName:"admonition"},"As such, we recommend using an alternative provider like ",(0,l.kt)("a",{parentName:"p",href:"#flyio"},"Fly.io")," for your first apps.")),(0,l.kt)("p",null,"You will need Heroku account, ",(0,l.kt)("inlineCode",{parentName:"p"},"heroku")," ",(0,l.kt)("a",{parentName:"p",href:"https://devcenter.heroku.com/articles/heroku-cli"},"CLI")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"docker")," CLI installed to follow these instructions."),(0,l.kt)("p",null,"Make sure you are logged in with ",(0,l.kt)("inlineCode",{parentName:"p"},"heroku")," CLI. You can check if you are logged in with ",(0,l.kt)("inlineCode",{parentName:"p"},"heroku whoami"),", and if you are not, you can log in with ",(0,l.kt)("inlineCode",{parentName:"p"},"heroku login"),"."),(0,l.kt)("h3",{id:"set-up-a-heroku-app"},"Set Up a Heroku App"),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"You need to do this only once per Wasp app.")),(0,l.kt)("p",null,"Unless you want to deploy to an existing Heroku app, let's create a new Heroku app:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"heroku create <app-name>\n")),(0,l.kt)("p",null,"Unless you have an external Postgres database that you want to use, let's create a new database on Heroku and attach it to our app:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"heroku addons:create --app <app-name> heroku-postgresql:mini\n")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"Heroku does not offer a free plan anymore and ",(0,l.kt)("inlineCode",{parentName:"p"},"mini")," is their cheapest database instance - it costs $5/mo.")),(0,l.kt)("p",null,"Heroku will also set ",(0,l.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," env var for us at this point. If you are using an external database, you will have to set it up yourself."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"PORT")," env var will also be provided by Heroku, so the only two left to set are the ",(0,l.kt)("inlineCode",{parentName:"p"},"JWT_SECRET")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," env vars:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"heroku config:set --app <app-name> JWT_SECRET=<random_string_at_least_32_characters_long>\nheroku config:set --app <app-name> WASP_WEB_CLIENT_URL=<url_of_where_frontend_will_be_deployed>\n")),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"If you do not know what your frontend URL is yet, don't worry. You can set ",(0,l.kt)("inlineCode",{parentName:"p"},"WASP_WEB_CLIENT_URL")," after you deploy your frontend.")),(0,l.kt)("h3",{id:"deploy-to-a-heroku-app"},"Deploy to a Heroku App"),(0,l.kt)("p",null,"After you have ",(0,l.kt)("a",{parentName:"p",href:"#1-generating-deployable-code"},"built the app"),", position yourself in ",(0,l.kt)("inlineCode",{parentName:"p"},".wasp/build/")," directory:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd .wasp/build\n")),(0,l.kt)("p",null,"assuming you were at the root of your Wasp project at that moment."),(0,l.kt)("p",null,"Log in to Heroku Container Registry:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"heroku container:login\n")),(0,l.kt)("p",null,"Build the docker image and push it to Heroku:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"heroku container:push --app <app-name> web\n")),(0,l.kt)("p",null,"App is still not deployed at this point.\nThis step might take some time, especially the very first time, since there are no cached docker layers."),(0,l.kt)("admonition",{title:"Note for Apple Silicon Users",type:"note"},(0,l.kt)("p",{parentName:"admonition"},"Apple Silicon users need to build a non-Arm image, so the above step will not work at this time. Instead of ",(0,l.kt)("inlineCode",{parentName:"p"},"heroku container:push"),", users instead should:"),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"docker buildx build --platform linux/amd64 -t <app-name> .\ndocker tag <app-name> registry.heroku.com/<app-name>/web\ndocker push registry.heroku.com/<app-name>/web\n")),(0,l.kt)("p",{parentName:"admonition"},"You are now ready to proceed to the next step.")),(0,l.kt)("p",null,"Deploy the pushed image and restart the app:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"heroku container:release --app <app-name> web\n")),(0,l.kt)("p",null,"This is it, the backend is deployed at ",(0,l.kt)("inlineCode",{parentName:"p"},"https://<app-name>-XXXX.herokuapp.com")," \ud83c\udf89"),(0,l.kt)("p",null,"Find out the exact app URL with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"heroku info --app <app-name>\n")),(0,l.kt)("p",null,"Additionally, you can check out the logs with:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"heroku logs --tail --app <app-name>\n")),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("mdxAdmonitionTitle",{parentName:"admonition"},"Using ",(0,l.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"pg-boss")," with Heroku"),(0,l.kt)("p",{parentName:"admonition"},"If you wish to deploy an app leveraging ",(0,l.kt)("a",{parentName:"p",href:"../../advanced/jobs"},"Jobs")," that use ",(0,l.kt)("inlineCode",{parentName:"p"},"pg-boss")," as the executor to Heroku, you need to set an additional environment variable called ",(0,l.kt)("inlineCode",{parentName:"p"},"PG_BOSS_NEW_OPTIONS")," to ",(0,l.kt)("inlineCode",{parentName:"p"},'{"connectionString":"<REGULAR_HEROKU_DATABASE_URL>","ssl":{"rejectUnauthorized":false}}'),". This is because pg-boss uses the ",(0,l.kt)("inlineCode",{parentName:"p"},"pg")," extension, which does not seem to connect to Heroku over SSL by default, which Heroku requires. Additionally, Heroku uses a self-signed cert, so we must handle that as well."),(0,l.kt)("p",{parentName:"admonition"},"Read more: ",(0,l.kt)("a",{parentName:"p",href:"https://devcenter.heroku.com/articles/connecting-heroku-postgres#connecting-in-node-js"},"https://devcenter.heroku.com/articles/connecting-heroku-postgres#connecting-in-node-js"))))}g.isMDXComponent=!0},63031:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/railway-rename-78e07d8f6359fdb9eca0dc982357fb89.png"}}]);